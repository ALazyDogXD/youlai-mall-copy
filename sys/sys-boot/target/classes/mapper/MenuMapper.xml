<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.alazydogxd.youlai.sys.boot.mapper.MenuMapper">

    <resultMap id="menuRole" type="com.alazydogxd.youlai.sys.boot.entity.MenuRoleDO">
        <id column="id" property="id"/>
        <result column="parent_id" property="parentId"/>
        <result column="name" property="name"/>
        <result column="path" property="path"/>
        <result column="component" property="component"/>
        <result column="icon" property="icon"/>
        <result column="redirect" property="redirect"/>
        <collection property="roleCodes" ofType="string" javaType="list">
            <result column="code"/>
        </collection>
    </resultMap>

    <select id="getByRoleCodes" resultMap="menuRole">
        SELECT ${ew.sqlSelect}
        FROM sys_role r
                RIGHT JOIN sys_role_permission rp
                        ON r.id = rp.role_id
                RIGHT JOIN sys_permission p
                        ON p.id = rp.permission_id
                RIGHT JOIN sys_permission_menu pm
                        ON pm.permission_id = p.id
                RIGHT JOIN sys_menu m
                        ON m.id = pm.menu_id
        WHERE p.type = 1
        <if test="roleCodes != null and roleCodes.size != 0">
            AND r.code IN
            <foreach collection="roleCodes" open="(" close=")" item="roleCode" separator=",">
                #{roleCode}
            </foreach>
        </if>
        <if test="ew != null and ew.customSqlSegment != null and ew.customSqlSegment != ''">
            AND
            <trim prefixOverrides="WHERE">
                ${ew.customSqlSegment}
            </trim>
        </if>
    </select>


</mapper>